# Example nginx configuration for CFML module
# Include this file in your nginx.conf

http {
    # CFML module settings
    cfml_cache on;
    cfml_cache_size 20m;
    cfml_session_timeout 30m;
    cfml_application_timeout 2d;
    
    # Define datasources (if using database features)
    # cfml_datasource mydb "mysql://user:password@localhost:3306/mydatabase";
    # cfml_datasource pgdb "postgresql://user:password@localhost:5432/mydb";
    
    server {
        listen 80;
        server_name localhost;
        root /var/www/cfml;
        
        # Default index files
        index index.cfm index.html;
        
        # Handle CFML files
        location ~ \.(cfm|cfc)$ {
            cfml on;
            cfml_root /var/www/cfml;
            cfml_index index.cfm Application.cfm;
            cfml_max_include_depth 100;
            cfml_request_timeout 30s;
            
            # Optional: proxy complex operations to Lucee
            # cfml_fastcgi_pass 127.0.0.1:8888;
        }
        
        # Serve static files directly
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 30d;
            add_header Cache-Control "public, immutable";
        }
        
        # Block access to sensitive files
        location ~ /\. {
            deny all;
        }
        
        location ~ \.(cfc)$ {
            # CFCs should not be directly accessible (except via CFML)
            cfml on;
        }
        
        # Error pages
        error_page 500 502 503 504 /error.cfm;
    }
    
    # HTTPS server example
    server {
        listen 443 ssl http2;
        server_name localhost;
        root /var/www/cfml;
        
        ssl_certificate /etc/ssl/certs/server.crt;
        ssl_certificate_key /etc/ssl/private/server.key;
        
        location ~ \.(cfm|cfc)$ {
            cfml on;
            cfml_root /var/www/cfml;
        }
    }
}
